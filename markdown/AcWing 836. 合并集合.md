# [AcWing 836. åˆå¹¶é›†åˆ](https://www.acwing.com/problem/content/838/)

## é¢˜ç›®æè¿°

ä¸€å…±æœ‰ ğ‘› ä¸ªæ•°ï¼Œç¼–å·æ˜¯ 1âˆ¼ğ‘›ï¼Œæœ€å¼€å§‹æ¯ä¸ªæ•°å„è‡ªåœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚

ç°åœ¨è¦è¿›è¡Œ ğ‘š ä¸ªæ“ä½œï¼Œæ“ä½œå…±æœ‰ä¸¤ç§ï¼š

1. `M a b`ï¼Œå°†ç¼–å·ä¸º ğ‘ å’Œ ğ‘ çš„ä¸¤ä¸ªæ•°æ‰€åœ¨çš„é›†åˆåˆå¹¶ï¼Œå¦‚æœä¸¤ä¸ªæ•°å·²ç»åœ¨åŒä¸€ä¸ªé›†åˆä¸­ï¼Œåˆ™å¿½ç•¥è¿™ä¸ªæ“ä½œï¼›
2. `Q a b`ï¼Œè¯¢é—®ç¼–å·ä¸º ğ‘ å’Œ ğ‘ çš„ä¸¤ä¸ªæ•°æ˜¯å¦åœ¨åŒä¸€ä¸ªé›†åˆä¸­ï¼›

**è¾“å…¥æ ¼å¼**

ç¬¬ä¸€è¡Œè¾“å…¥æ•´æ•° ğ‘› å’Œ ğ‘šã€‚

æ¥ä¸‹æ¥ ğ‘š è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸€ä¸ªæ“ä½œæŒ‡ä»¤ï¼ŒæŒ‡ä»¤ä¸º `M a b` æˆ– `Q a b` ä¸­çš„ä¸€ç§ã€‚

**è¾“å‡ºæ ¼å¼**

å¯¹äºæ¯ä¸ªè¯¢é—®æŒ‡ä»¤ `Q a b`ï¼Œéƒ½è¦è¾“å‡ºä¸€ä¸ªç»“æœï¼Œå¦‚æœ ğ‘ å’Œ ğ‘ åœ¨åŒä¸€é›†åˆå†…ï¼Œåˆ™è¾“å‡º `Yes`ï¼Œå¦åˆ™è¾“å‡º `No`ã€‚

æ¯ä¸ªç»“æœå ä¸€è¡Œã€‚

**æ•°æ®èŒƒå›´**

1â‰¤ğ‘›,ğ‘šâ‰¤10^5

**è¾“å…¥æ ·ä¾‹**ï¼š

```cpp
4 5
M 1 2
M 3 4
Q 1 2
Q 1 3
Q 3 4
```

**è¾“å‡ºæ ·ä¾‹**ï¼š

```cpp
Yes
No
Yes
```

## C++

```cpp
#include <iostream>

using namespace std;

const int N = 100010;

int fa[N]; // å­˜å‚¨æ¯ä¸ªå…ƒç´ çš„çˆ¶èŠ‚ç‚¹ï¼Œç”¨äºè¡¨ç¤ºä¸ç›¸äº¤é›†åˆä¸­çš„é›†åˆ

// æŸ¥æ‰¾å…ƒç´  x æ‰€åœ¨é›†åˆçš„æ ¹èŠ‚ç‚¹ï¼ˆå³ä»£è¡¨å…ƒç´ ï¼‰
int find(int x) {
    // å¦‚æœå½“å‰å…ƒç´ çš„çˆ¶èŠ‚ç‚¹ä¸æ˜¯è‡ªèº«ï¼Œåˆ™é€’å½’æŸ¥æ‰¾æ ¹èŠ‚ç‚¹ï¼Œå¹¶è¿›è¡Œè·¯å¾„å‹ç¼©
    if (fa[x] != x) fa[x] = find(fa[x]);
    return fa[x];
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);

    int n, m;
    cin >> n >> m;

    // åˆå§‹åŒ–ä¸ç›¸äº¤é›†åˆï¼Œæ¯ä¸ªå…ƒç´ åˆå§‹æ—¶çˆ¶èŠ‚ç‚¹ä¸ºè‡ªèº«
    for (int i = 1; i <= n; i++) fa[i] = i;

    while (m--) {
        char op;
        int a, b;
        cin >> op >> a >> b;

        // å¦‚æœæ“ä½œæ˜¯åˆå¹¶ ('M')ï¼Œå°†åŒ…å«å…ƒç´  'a' å’Œ 'b' çš„é›†åˆåˆå¹¶
        if (op == 'M') fa[find(a)] = find(b);
        else {
            // å¦‚æœæ“ä½œæ˜¯æŸ¥è¯¢ ('Q')ï¼Œæ£€æŸ¥å…ƒç´  'a' å’Œ 'b' æ˜¯å¦å±äºåŒä¸€ä¸ªé›†åˆ
            if (find(a) == find(b)) puts("Yes");
            else puts("No");
        }
    }

    return 0;
}
```

## Go

```go
package main

import (
	"bufio"
	"fmt"
	"os"
)

const N = 100010

var fa [N]int

func find(x int) int {
	if fa[x] != x {
		fa[x] = find(fa[x])
	}
	return fa[x]
}

func main() {
	reader := bufio.NewReader(os.Stdin)
	writer := bufio.NewWriter(os.Stdout)
	defer writer.Flush()

	var n, m int
	fmt.Fscanf(reader, "%d %d\n", &n, &m)

	for i := 1; i <= n; i++ {
		fa[i] = i
	}

	for ; m > 0; m-- {
		var op byte
		var a, b int
		fmt.Fscanf(reader, "%c %d %d\n", &op, &a, &b)

		if op == 'M' {
			fa[find(a)] = find(b)
		} else {
			if find(a) == find(b) {
				fmt.Fprintln(writer, "Yes")
			} else {
				fmt.Fprintln(writer, "No")
			}
		}
	}
}
```

## æ¨¡æ¿

```cpp
(1)æœ´ç´ å¹¶æŸ¥é›†ï¼š

    int p[N]; //å­˜å‚¨æ¯ä¸ªç‚¹çš„ç¥–å®—èŠ‚ç‚¹

    // è¿”å›xçš„ç¥–å®—èŠ‚ç‚¹
    int find(int x)
    {
        if (p[x] != x) p[x] = find(p[x]);
        return p[x];
    }

    // åˆå§‹åŒ–ï¼Œå‡å®šèŠ‚ç‚¹ç¼–å·æ˜¯1~n
    for (int i = 1; i <= n; i ++ ) p[i] = i;

    // åˆå¹¶aå’Œbæ‰€åœ¨çš„ä¸¤ä¸ªé›†åˆï¼š
    p[find(a)] = find(b);


(2)ç»´æŠ¤sizeçš„å¹¶æŸ¥é›†ï¼š

    int p[N], size[N];
    //p[]å­˜å‚¨æ¯ä¸ªç‚¹çš„ç¥–å®—èŠ‚ç‚¹, size[]åªæœ‰ç¥–å®—èŠ‚ç‚¹çš„æœ‰æ„ä¹‰ï¼Œè¡¨ç¤ºç¥–å®—èŠ‚ç‚¹æ‰€åœ¨é›†åˆä¸­çš„ç‚¹çš„æ•°é‡

    // è¿”å›xçš„ç¥–å®—èŠ‚ç‚¹
    int find(int x)
    {
        if (p[x] != x) p[x] = find(p[x]);
        return p[x];
    }

    // åˆå§‹åŒ–ï¼Œå‡å®šèŠ‚ç‚¹ç¼–å·æ˜¯1~n
    for (int i = 1; i <= n; i ++ )
    {
        p[i] = i;
        size[i] = 1;
    }

    // åˆå¹¶aå’Œbæ‰€åœ¨çš„ä¸¤ä¸ªé›†åˆï¼š
    size[find(b)] += size[find(a)];
    p[find(a)] = find(b);


(3)ç»´æŠ¤åˆ°ç¥–å®—èŠ‚ç‚¹è·ç¦»çš„å¹¶æŸ¥é›†ï¼š

    int p[N], d[N];
    //p[]å­˜å‚¨æ¯ä¸ªç‚¹çš„ç¥–å®—èŠ‚ç‚¹, d[x]å­˜å‚¨xåˆ°p[x]çš„è·ç¦»

    // è¿”å›xçš„ç¥–å®—èŠ‚ç‚¹
    int find(int x)
    {
        if (p[x] != x)
        {
            int u = find(p[x]);
            d[x] += d[p[x]];
            p[x] = u;
        }
        return p[x];
    }

    // åˆå§‹åŒ–ï¼Œå‡å®šèŠ‚ç‚¹ç¼–å·æ˜¯1~n
    for (int i = 1; i <= n; i ++ )
    {
        p[i] = i;
        d[i] = 0;
    }

    // åˆå¹¶aå’Œbæ‰€åœ¨çš„ä¸¤ä¸ªé›†åˆï¼š
    p[find(a)] = find(b);
    d[find(a)] = distance; // æ ¹æ®å…·ä½“é—®é¢˜ï¼Œåˆå§‹åŒ–find(a)çš„åç§»é‡
```

